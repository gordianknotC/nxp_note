
## Add Android Project Into Flutter
å¯¦éš›ç›®éŒ„çµæ§‹å¦‚ä¸‹åœ–
![structure](https://gordianknot1981.github.io/nxp_note/flutter/flutter_android_structure.png )

## Flutter/Android å°ˆæ¡ˆç›®éŒ„çµæ§‹èªªæ˜

file structure of a flutter project would be look like this
- ğŸ“ FlutterProject
	- ğŸ“° pubspec.yaml 
	- ğŸ“ lib [1]
	- ğŸ“ android [2]
	- ğŸ“ res [3]
>[1]  libraries written in dart.
[2]  an android project wrapper for flutter, which contains following structure
> - ğŸ“ app
	- ğŸ“° build.gradle
	- ğŸ“° local.properties 
>- ğŸ“ res
>- ğŸ“ assets
>- ğŸ“° build.gradle
>- ğŸ“° settings.gradle
>
>[3] android resource folder for flutter project,  generated by flutter.

### èªªæ˜Android Project wrapper for flutter
#### file structure
- ğŸ“ app[^1]
	- ğŸ“ libs
	- ğŸ“ src
	- ğŸ“° build.gradle [^2]
- ğŸ“ res[^*]
- ğŸ“ assets[^*]
- ğŸ“° build.gradle[^3]
- ğŸ“° settings.gradle[^4]
- ğŸ“° local.properties [^5]

**[1] app** your existing android project 
 #### ç¾æœ‰çš„android project
 éœ€å°‡å…¶folderæ”¹åç‚ºappï¼Œappä¼¼ä¹ç‚ºflutteré»˜èªçš„androidå°ˆæ¡ˆåç¨±ï¼Œä»¥å‘ŠçŸ¥flutterå°ˆæ¡ˆè¨­å®šçš„ä½ç½®(build.gradle, settings.gradle)ï¼Œå¦‚æœä¸ç”¨é»˜èªçš„åç¨±ä¼¼ä¹ä¹Ÿå¯ä»¥ï¼Œä½†éœ€è¦è¨­å®šproject.nameåŠinclude nameï¼Œå¾Œæ–‡æœƒå¯«åˆ°ã€‚

android project folder, this would be your existing android project renamed to "app".  "app" seems like a default naming convention for flutter to indicate project entry folder where configurations(build.gradle and local.properties) locates. For not using convention name, you need to setup project name and include name in build.gradle, which will refer later on.
 
 
**[2] build.gradle** : build script for existing android project
#### ç¾æœ‰å°ˆæ¡ˆè¨­å®šæª” 
è‹¥è¦å°‡ç¾æœ‰å°ˆæ¡ˆèˆ‡flutteré€£çµ,éœ€åœ¨è©²è¨­å®šæª”ä¸­å¯«å…¥ä»¥ä¸‹è³‡è¨Š
- è¼‰å…¥local.properties
- flutterRoot 
- flutterProject
- apply pluginId **&** apply from
- sourceSets
- applicationId
- dependencies

> #### local.properties
> indicates where flutter.sdk and android.sdk locate.
```groovy
	def localProperties = new Properties()  
	def localPropertiesFile = rootProject.file('local.properties')  
	if (localPropertiesFile.exists()) {  
	    localPropertiesFile.withReader('UTF-8') { reader ->  
	        localProperties.load(reader)  
	    }  
	}
```
> ä¸»è¦è¨˜éŒ„äº†flutter.sdkåŠandroid.sdkçš„ä½ç½®, ä»‹ç”±è®€å– local.properties ä»¥æ³¨å…¥flutter
> - rootProject æŒ‡å‘ android , 
> - localPropertiesFile  æŒ‡å‘ android/local.properties

> #### flutterRoot
> read flutter sdk from local.properties into flutterRoot
```groovy
	def flutterRoot = localProperties.getProperty('flutter.sdk')  
	if (flutterRoot == null) {  
	    throw new GradleException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")  
	}
```

> #### flutterProject
> specify where flutterProject locates, default value are "../.."
```groovy
	def flutterProject = '../..'
	flutter {  
	    source flutterProject  
	}
```

> #### apply plugin | apply from
> contains following two sections
>  - apply plugins like kotlin which indicates a valid pluginId implmented the plugin interface by project requirements.
>  - apply a build script from flutter
```groovy
	apply plugin: 'com.android.application'  
	apply plugin: 'kotlin-android'  
	apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"
```

> #### sourcesSet
> set entry point for finding sources
> - java source
> - res source
	> res åˆ†ç‚ºäºŒå€‹éƒ¨ä»½ï¼Œä¸€å€‹æ˜¯åŸæœ‰å°ˆæ¡ˆçš„res, å¦ä¸€å€‹å‰‡ç‚ºflutterå°ˆæ¡ˆæ‰€éœ€è¦çš„ resï¼Œç”±flutterè‡ªå‹•ç”¢ç”Ÿ
>   - res resource of existing android project
>   - res source of current flutter project	
> - assets source
```groovy
	android {  
		sourceSets {  
			main {  
				//manifest.srcFile "src/main/AndroidManifest.xml"  
				java.srcDirs += ['src/main/kotlin', 'src/main/java']  
				res.srcDirs += ['res', flutterProject + '/res']  
				assets.srcDirs += ['assets', flutterProject + '/assets']  
			}  
```

> #### applicationId
> 
```groovy
	android {
		defaultConfig {  
			// applicationId will replace package name specified in AndroidManifest.xml  
			applicationId "com.gknot"  
			minSdkVersion 19  
			targetSdkVersion 28  
			versionName flutterVersionName  
			testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"  
		}
```

> #### dependencies
```groovy
	dependencies {  
		implementation fileTree(include: '*.jar', dir: 'libs')  
		implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"  
		//following dependencies depends on flutter  
		testImplementation 'junit:junit:4.12'  
		androidTestImplementation 'com.android.support.test:runner:1.0.2'  
		androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'  
	}
```

**[*]res and assets** for existing android project
#### ç¾æœ‰å°ˆæ¡ˆçš„ res & assets
æ–¼ä¸Šè¿°build.gradleä¸­è¨­å®š

**[3] build.gradle** for flutter

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTUxMDgzMDg3NSwxNDYwMzA4MDU0LDE1Nj
EwMjIzMjksODAxMjQzMjQ2LC0zNjQ2ODAzMjEsLTE5MzY0Nzky
NTUsLTE3NzQ2OTY4ODJdfQ==
-->